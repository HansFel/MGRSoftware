{% extends "base.html" %}

{% block title %}CSV-Format konfigurieren - {{ gemeinschaft_name }} - Maschinengemeinschaft{% endblock %}

{% block content %}
<div class="row mt-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-white">
                <i class="bi bi-gear"></i> CSV-Format konfigurieren: {{ gemeinschaft_name }}
            </h2>
            <a href="{{ url_for('admin_csv_import', gemeinschaft_id=gemeinschaft_id) }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Zurück zum Import
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-sliders"></i> Import-Einstellungen
                </h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <h6 class="mb-3">Allgemeine Einstellungen</h6>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="trennzeichen" class="form-label">Trennzeichen *</label>
                            <select class="form-select" id="trennzeichen" name="trennzeichen" required>
                                <option value=";" {{ 'selected' if config.trennzeichen == ';' else '' }}>Semikolon (;)</option>
                                <option value="," {{ 'selected' if config.trennzeichen == ',' else '' }}>Komma (,)</option>
                                <option value="\t" {{ 'selected' if config.trennzeichen == '\t' else '' }}>Tabulator</option>
                                <option value="|" {{ 'selected' if config.trennzeichen == '|' else '' }}>Pipe (|)</option>
                            </select>
                            <div class="form-text">Spalten-Trennzeichen in der CSV-Datei</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="kodierung" class="form-label">Zeichenkodierung *</label>
                            <select class="form-select" id="kodierung" name="kodierung" required>
                                <option value="utf-8-sig" {{ 'selected' if config.kodierung == 'utf-8-sig' else '' }}>UTF-8 (mit BOM)</option>
                                <option value="utf-8" {{ 'selected' if config.kodierung == 'utf-8' else '' }}>UTF-8</option>
                                <option value="iso-8859-1" {{ 'selected' if config.kodierung == 'iso-8859-1' else '' }}>ISO-8859-1 (Latin-1)</option>
                                <option value="cp1252" {{ 'selected' if config.kodierung == 'cp1252' else '' }}>Windows-1252</option>
                            </select>
                            <div class="form-text">Textcodierung der Datei</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="zeilen_ueberspringen" class="form-label">Zeilen überspringen</label>
                            <input type="number" class="form-control" id="zeilen_ueberspringen" 
                                   name="zeilen_ueberspringen" min="0" max="10"
                                   value="{{ config.zeilen_ueberspringen }}">
                            <div class="form-text">Anzahl Zeilen am Anfang überspringen</div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="hat_kopfzeile" 
                                       name="hat_kopfzeile" {{ 'checked' if config.hat_kopfzeile else '' }}>
                                <label class="form-check-label" for="hat_kopfzeile">
                                    CSV hat Kopfzeile
                                </label>
                                <div class="form-text">
                                    Erste Zeile enthält Spaltennamen<br>
                                    <strong>Raiffeisen Elba:</strong> Kein Häkchen (keine Kopfzeile)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <h6 class="mb-3">Spalten-Namen (genau wie in der CSV-Datei)</h6>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="spalte_buchungsdatum" class="form-label">Buchungsdatum *</label>
                            <input type="text" class="form-control" id="spalte_buchungsdatum" 
                                   name="spalte_buchungsdatum" required
                                   value="{{ config.spalte_buchungsdatum }}">
                            <div class="form-text">
                                Z.B. "Buchungstag" oder "Buchungsdatum"<br>
                                <strong>Ohne Kopfzeile:</strong> Spalte1, Spalte2, etc.
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="spalte_valutadatum" class="form-label">Valutadatum</label>
                            <input type="text" class="form-control" id="spalte_valutadatum" 
                                   name="spalte_valutadatum"
                                   value="{{ config.spalte_valutadatum }}">
                            <div class="form-text">Optional</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="spalte_betrag" class="form-label">Betrag *</label>
                            <input type="text" class="form-control" id="spalte_betrag" 
                                   name="spalte_betrag" required
                                   value="{{ config.spalte_betrag }}">
                            <div class="form-text">Z.B. "Betrag" oder "Amount"</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="spalte_verwendungszweck" class="form-label">Verwendungszweck *</label>
                            <input type="text" class="form-control" id="spalte_verwendungszweck" 
                                   name="spalte_verwendungszweck" required
                                   value="{{ config.spalte_verwendungszweck }}">
                            <div class="form-text">Z.B. "Verwendungszweck" oder "Reference"</div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="spalte_empfaenger" class="form-label">Empfänger/Zahler</label>
                            <input type="text" class="form-control" id="spalte_empfaenger" 
                                   name="spalte_empfaenger"
                                   value="{{ config.spalte_empfaenger }}">
                            <div class="form-text">Optional</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="spalte_kontonummer" class="form-label">Kontonummer/IBAN</label>
                            <input type="text" class="form-control" id="spalte_kontonummer" 
                                   name="spalte_kontonummer"
                                   value="{{ config.spalte_kontonummer }}">
                            <div class="form-text">Optional</div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <h6 class="mb-3">Zahlen- und Datumsformat</h6>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="dezimaltrennzeichen" class="form-label">Dezimaltrennzeichen *</label>
                            <select class="form-select" id="dezimaltrennzeichen" name="dezimaltrennzeichen" required>
                                <option value="," {{ 'selected' if config.dezimaltrennzeichen == ',' else '' }}>Komma (,)</option>
                                <option value="." {{ 'selected' if config.dezimaltrennzeichen == '.' else '' }}>Punkt (.)</option>
                            </select>
                            <div class="form-text">Z.B. 1234,56</div>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="tausendertrennzeichen" class="form-label">Tausendertrennzeichen *</label>
                            <select class="form-select" id="tausendertrennzeichen" name="tausendertrennzeichen" required>
                                <option value="." {{ 'selected' if config.tausendertrennzeichen == '.' else '' }}>Punkt (.)</option>
                                <option value="," {{ 'selected' if config.tausendertrennzeichen == ',' else '' }}>Komma (,)</option>
                                <option value=" " {{ 'selected' if config.tausendertrennzeichen == ' ' else '' }}>Leerzeichen</option>
                                <option value="" {{ 'selected' if config.tausendertrennzeichen == '' else '' }}>Keins</option>
                            </select>
                            <div class="form-text">Z.B. 1.234,56</div>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="datumsformat" class="form-label">Datumsformat *</label>
                            <select class="form-select" id="datumsformat" name="datumsformat" required>
                                <option value="%d.%m.%Y" {{ 'selected' if config.datumsformat == '%d.%m.%Y' else '' }}>TT.MM.JJJJ</option>
                                <option value="%Y-%m-%d" {{ 'selected' if config.datumsformat == '%Y-%m-%d' else '' }}>JJJJ-MM-TT</option>
                                <option value="%m/%d/%Y" {{ 'selected' if config.datumsformat == '%m/%d/%Y' else '' }}>MM/TT/JJJJ</option>
                                <option value="%d/%m/%Y" {{ 'selected' if config.datumsformat == '%d/%m/%Y' else '' }}>TT/MM/JJJJ</option>
                            </select>
                            <div class="form-text">Z.B. 31.12.2025</div>
                        </div>
                    </div>
                    
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-check-circle"></i> Konfiguration speichern
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card bg-info text-white mb-3">
            <div class="card-body">
                <h5><i class="bi bi-lightbulb"></i> Tipp</h5>
                <p class="mb-0">
                    Öffnen Sie Ihre CSV-Datei mit einem Text-Editor, um die genauen Spaltennamen 
                    und das Format zu sehen.
                </p>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-question-circle"></i> Beispiel
                </h5>
            </div>
            <div class="card-body">
                <h6>Typisches deutsches Bankenformat:</h6>
                <pre class="bg-light p-2 rounded small">Buchungstag;Betrag;Verwendungszweck
01.01.2026;1.234,56;Zahlung MGR-1-5-12
02.01.2026;-50,00;Überweisung</pre>
                
                <h6 class="mt-3">Raiffeisen Elba (ohne Kopfzeile):</h6>
                <pre class="bg-light p-2 rounded small">30.12.2024;"Beschreibung...";30.12.2024;6116,70;EUR
31.12.2024;"Beschreibung...";31.12.2024;-140,00;EUR</pre>
                <p class="small"><strong>Spalten:</strong> Spalte1=Buchung, Spalte2=Beschreibung, Spalte3=Valuta, Spalte4=Betrag</p>
                
                <h6 class="mt-3">Einstellungen:</h6>
                <ul class="small">
                    <li>Trennzeichen: <code>;</code></li>
                    <li>Dezimal: <code>,</code></li>
                    <li>Tausender: <code>.</code> oder leer</li>
                    <li>Datum: <code>TT.MM.JJJJ</code></li>
                    <li><strong>Kopfzeile:</strong> Ja/Nein je nach Bank</li>
                </ul>
            </div>
        </div>
    </div>
</div>

{% endblock %}
